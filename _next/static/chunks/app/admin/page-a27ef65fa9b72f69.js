(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{3168:(e,t,r)=>{"use strict";r.d(t,{Dv:()=>n,mB:()=>a,tn:()=>i,us:()=>o,y1:()=>l});let s=(0,r(5647).UU)("https://rtajuzunzkoamruejtim.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ0YWp1enVuemtvYW1ydWVqdGltIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxNDA0MTMsImV4cCI6MjA2OTcxNjQxM30.dlestmqzHPy-zMeJubohj13dvPaZ7MEUeoRti5OF0uU"),a={async getAll(){let{data:e,error:t}=await s.from("equipamentos").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:r}=await s.from("equipamentos").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async update(e,t){let{data:r,error:a}=await s.from("equipamentos").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select();if(a)throw a;return null==r?void 0:r[0]},async delete(e){let{error:t}=await s.from("equipamentos").delete().eq("id",e);if(t)throw t},async checkCodeExists(e){let{data:t,error:r}=await s.from("equipamentos").select("id").eq("codigo",e).limit(1);if(r)throw r;return((null==t?void 0:t.length)||0)>0}},i={async getAll(){let{data:e,error:t}=await s.from("equipamentos_utilizados").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:r}=await s.from("equipamentos_utilizados").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async return(e){let{error:t}=await s.from("equipamentos_utilizados").delete().eq("id",e);if(t)throw t}},l={async signIn(e,t){let{data:r,error:a}=await s.auth.signInWithPassword({email:e,password:t});if(a)throw a;return r},async signUp(e,t,r){let{data:a,error:i}=await s.auth.signUp({email:e,password:t,options:{data:{nome:r}}});if(i)throw i;return a},async signOut(){let{error:e}=await s.auth.signOut();if(e)throw e},async getCurrentUser(){let{data:{user:e}}=await s.auth.getUser();return e},async getSession(){let{data:{session:e}}=await s.auth.getSession();return e}},n={async createProfile(e){let{data:t,error:r}=await s.from("user_profiles").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async getProfile(e){let{data:t,error:r}=await s.from("user_profiles").select("*").eq("id",e).single();if(r)throw r;return t},async getAllUsers(){let{data:e,error:t}=await s.from("user_profiles").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async approveUser(e,t){let{data:r,error:a}=await s.from("user_profiles").update({status:"approved",approved_at:new Date().toISOString(),approved_by:t}).eq("id",e).select();if(a)throw a;return null==r?void 0:r[0]},async deactivateUser(e){let{data:t,error:r}=await s.from("user_profiles").update({status:"inactive"}).eq("id",e).select();if(r)throw r;return null==t?void 0:t[0]},async activateUser(e){let{data:t,error:r}=await s.from("user_profiles").update({status:"approved"}).eq("id",e).select();if(r)throw r;return null==t?void 0:t[0]},async isAdmin(e){let t=await this.getProfile(e);return(null==t?void 0:t.role)==="admin"&&(null==t?void 0:t.status)==="approved"}},o={async getByUser(e){let{data:t,error:r}=await s.from("equipamentos").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]},async getAllForAdmin(){let{data:e,error:t}=await s.from("equipamentos").select("\n        *,\n        user_profiles!equipamentos_user_id_fkey(nome, email)\n      ").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:r}=await s.from("equipamentos").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async checkCodeExistsForUser(e,t){let{data:r,error:a}=await s.from("equipamentos").select("id").eq("codigo",e).eq("user_id",t).limit(1);if(a)throw a;return((null==r?void 0:r.length)||0)>0}}},7161:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),a=r(2115),i=r(6874),l=r.n(i),n=r(5695),o=r(3168);function c(){let e=(0,n.useRouter)(),[t,r]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[d,u]=(0,a.useState)(null),[x,m]=(0,a.useState)("pending");(0,a.useEffect)(()=>{p()},[]);let p=async()=>{try{let t=await o.y1.getCurrentUser();if(!t)return void e.push("/login");if(!await o.Dv.isAdmin(t.id))return void e.push("/");u(t),await h()}catch(t){console.error("Erro ao verificar autentica\xe7\xe3o:",t),e.push("/login")}},h=async()=>{try{c(!0);let e=await o.Dv.getAllUsers();r(e)}catch(e){console.error("Erro ao carregar usu\xe1rios:",e)}finally{c(!1)}},g=async e=>{try{await o.Dv.approveUser(e,d.id),await h()}catch(e){console.error("Erro ao aprovar usu\xe1rio:",e),alert("Erro ao aprovar usu\xe1rio")}},f=async e=>{try{await o.Dv.deactivateUser(e),await h()}catch(e){console.error("Erro ao desativar usu\xe1rio:",e),alert("Erro ao desativar usu\xe1rio")}},v=async e=>{try{await o.Dv.deactivateUser(e),await h()}catch(e){console.error("Erro ao recusar usu\xe1rio:",e),alert("Erro ao recusar usu\xe1rio")}},w=async e=>{try{await o.Dv.activateUser(e),await h()}catch(e){console.error("Erro ao ativar usu\xe1rio:",e),alert("Erro ao ativar usu\xe1rio")}},y=async()=>{try{await o.y1.signOut(),e.push("/login")}catch(e){console.error("Erro ao fazer logout:",e)}},j=t.filter(e=>e.status===x),b=t.filter(e=>"pending"===e.status).length,N=t.filter(e=>"approved"===e.status).length,_=t.filter(e=>"inactive"===e.status).length;return i?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-purple-200 border-t-purple-500 rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Carregando painel administrativo..."})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 p-4",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center",children:(0,s.jsx)("i",{className:"ri-admin-line text-purple-500 text-2xl"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Painel Administrativo"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Gerenciar usu\xe1rios do sistema"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(l(),{href:"/",children:(0,s.jsxs)("button",{className:"px-4 py-2 bg-gray-100 text-gray-600 rounded-xl hover:bg-gray-200 transition-colors flex items-center gap-2",children:[(0,s.jsx)("i",{className:"ri-home-line"}),"Sistema"]})}),(0,s.jsxs)("button",{onClick:y,className:"px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors flex items-center gap-2",children:[(0,s.jsx)("i",{className:"ri-logout-circle-line"}),"Sair"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,s.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("i",{className:"ri-time-line text-yellow-500 text-2xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-yellow-700",children:b}),(0,s.jsx)("p",{className:"text-sm text-yellow-600",children:"Aguardando Aprova\xe7\xe3o"})]})]})}),(0,s.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("i",{className:"ri-check-circle-line text-green-500 text-2xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-green-700",children:N}),(0,s.jsx)("p",{className:"text-sm text-green-600",children:"Usu\xe1rios Aprovados"})]})]})}),(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("i",{className:"ri-close-circle-line text-red-500 text-2xl"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-2xl font-bold text-red-700",children:_}),(0,s.jsx)("p",{className:"text-sm text-red-600",children:"Usu\xe1rios Inativos"})]})]})})]}),(0,s.jsxs)("div",{className:"flex bg-gray-100 rounded-full p-1",children:[(0,s.jsxs)("button",{onClick:()=>m("pending"),className:"flex-1 py-3 px-4 rounded-full text-sm font-medium transition-all ".concat("pending"===x?"bg-yellow-500 text-white shadow-md":"text-gray-600 hover:text-yellow-500"),children:["Pendentes (",b,")"]}),(0,s.jsxs)("button",{onClick:()=>m("approved"),className:"flex-1 py-3 px-4 rounded-full text-sm font-medium transition-all ".concat("approved"===x?"bg-green-500 text-white shadow-md":"text-gray-600 hover:text-green-500"),children:["Aprovados (",N,")"]}),(0,s.jsxs)("button",{onClick:()=>m("inactive"),className:"flex-1 py-3 px-4 rounded-full text-sm font-medium transition-all ".concat("inactive"===x?"bg-red-500 text-white shadow-md":"text-gray-600 hover:text-red-500"),children:["Inativos (",_,")"]})]})]}),(0,s.jsx)("div",{className:"space-y-4",children:0===j.length?(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,s.jsx)("i",{className:"ri-user-line text-gray-400 text-2xl"})}),(0,s.jsxs)("p",{className:"text-gray-500",children:["Nenhum usu\xe1rio ","pending"===x?"pendente":"approved"===x?"aprovado":"inativo"]})]}):j.map(e=>(0,s.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center ".concat("admin"===e.role?"bg-purple-100":"bg-blue-100"),children:(0,s.jsx)("i",{className:"text-2xl ".concat("admin"===e.role?"ri-admin-line text-purple-500":"ri-user-line text-blue-500")})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[e.nome,"admin"===e.role&&(0,s.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-600 text-xs rounded-full",children:"Admin"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.email}),(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["Cadastrado em: ",new Date(e.created_at).toLocaleDateString("pt-BR")]}),e.approved_at&&(0,s.jsxs)("p",{className:"text-xs text-gray-400",children:["Aprovado em: ",new Date(e.approved_at).toLocaleDateString("pt-BR")]})]})]}),"admin"!==e.role&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["pending"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>g(e.id),className:"px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors flex items-center gap-2",children:[(0,s.jsx)("i",{className:"ri-check-line"}),"Aprovar"]}),(0,s.jsxs)("button",{onClick:()=>v(e.id),className:"px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors flex items-center gap-2",children:[(0,s.jsx)("i",{className:"ri-close-line"}),"Recusar"]})]}),"approved"===e.status&&(0,s.jsxs)("button",{onClick:()=>f(e.id),className:"px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors flex items-center gap-2",children:[(0,s.jsx)("i",{className:"ri-close-line"}),"Desativar"]}),"inactive"===e.status&&(0,s.jsxs)("button",{onClick:()=>w(e.id),className:"px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors flex items-center gap-2",children:[(0,s.jsx)("i",{className:"ri-check-line"}),"Ativar"]})]})]})},e.id))})]})})}},9350:(e,t,r)=>{Promise.resolve().then(r.bind(r,7161))}},e=>{var t=t=>e(e.s=t);e.O(0,[754,441,684,358],()=>t(9350)),_N_E=e.O()}]);
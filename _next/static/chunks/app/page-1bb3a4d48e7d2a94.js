(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2967:(e,t,s)=>{Promise.resolve().then(s.bind(s,5054))},3168:(e,t,s)=>{"use strict";s.d(t,{Dv:()=>n,mB:()=>i,tn:()=>l,us:()=>o,y1:()=>r});let a=(0,s(5647).UU)("https://thtknmmhtfjikzxznjxi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRodGtubW1odGZqaWt6eHpuanhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1OTU0MjYsImV4cCI6MjA2ODE3MTQyNn0.Aex9osM2zlneafmSUtmeOt-4pEFOB4JOIeqQdvdKSkA"),i={async getAll(){let{data:e,error:t}=await a.from("equipamentos").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:s}=await a.from("equipamentos").insert([e]).select();if(s)throw s;return null==t?void 0:t[0]},async update(e,t){let{data:s,error:i}=await a.from("equipamentos").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select();if(i)throw i;return null==s?void 0:s[0]},async delete(e){let{error:t}=await a.from("equipamentos").delete().eq("id",e);if(t)throw t},async checkCodeExists(e){let{data:t,error:s}=await a.from("equipamentos").select("id").eq("codigo",e).limit(1);if(s)throw s;return((null==t?void 0:t.length)||0)>0}},l={async getAll(){let{data:e,error:t}=await a.from("equipamentos_utilizados").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:s}=await a.from("equipamentos_utilizados").insert([e]).select();if(s)throw s;return null==t?void 0:t[0]},async return(e){let{error:t}=await a.from("equipamentos_utilizados").delete().eq("id",e);if(t)throw t}},r={async signIn(e,t){let{data:s,error:i}=await a.auth.signInWithPassword({email:e,password:t});if(i)throw i;return s},async signUp(e,t,s){let{data:i,error:l}=await a.auth.signUp({email:e,password:t,options:{data:{nome:s}}});if(l)throw l;return i},async signOut(){let{error:e}=await a.auth.signOut();if(e)throw e},async getCurrentUser(){let{data:{user:e}}=await a.auth.getUser();return e},async getSession(){let{data:{session:e}}=await a.auth.getSession();return e}},n={async createProfile(e){let{data:t,error:s}=await a.from("user_profiles").insert([e]).select();if(s)throw s;return null==t?void 0:t[0]},async getProfile(e){let{data:t,error:s}=await a.from("user_profiles").select("*").eq("id",e).single();if(s)throw s;return t},async getAllUsers(){let{data:e,error:t}=await a.from("user_profiles").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async approveUser(e,t){let{data:s,error:i}=await a.from("user_profiles").update({status:"approved",approved_at:new Date().toISOString(),approved_by:t}).eq("id",e).select();if(i)throw i;return null==s?void 0:s[0]},async deactivateUser(e){let{data:t,error:s}=await a.from("user_profiles").update({status:"inactive"}).eq("id",e).select();if(s)throw s;return null==t?void 0:t[0]},async activateUser(e){let{data:t,error:s}=await a.from("user_profiles").update({status:"approved"}).eq("id",e).select();if(s)throw s;return null==t?void 0:t[0]},async isAdmin(e){let t=await this.getProfile(e);return(null==t?void 0:t.role)==="admin"&&(null==t?void 0:t.status)==="approved"}},o={async getByUser(e){let{data:t,error:s}=await a.from("equipamentos").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(s)throw s;return t||[]},async getAllForAdmin(){let{data:e,error:t}=await a.from("equipamentos").select("\n        *,\n        user_profiles!equipamentos_user_id_fkey(nome, email)\n      ").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:s}=await a.from("equipamentos").insert([e]).select();if(s)throw s;return null==t?void 0:t[0]},async checkCodeExistsForUser(e,t){let{data:s,error:i}=await a.from("equipamentos").select("id").eq("codigo",e).eq("user_id",t).limit(1);if(i)throw i;return((null==s?void 0:s.length)||0)>0}}},5054:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(5155),i=s(2115),l=s(6874),r=s.n(l),n=s(5695),o=s(3168);function d(e){let{message:t="Carregando..."}=e;return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("div",{className:"w-8 h-8 border-3 border-blue-500 border-t-transparent rounded-full animate-spin"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:t}),(0,a.jsx)("p",{className:"text-gray-600 text-sm",children:"Aguarde um momento..."})]})})}function c(){let e=(0,n.useRouter)(),[t,s]=(0,i.useState)("estoque"),[l,c]=(0,i.useState)([]),[u,m]=(0,i.useState)([]),[x,h]=(0,i.useState)(!0),[g,p]=(0,i.useState)(null),[f,b]=(0,i.useState)(""),[w,j]=(0,i.useState)(null),[v,y]=(0,i.useState)(null);(0,i.useEffect)(()=>{let t=!0;return(async()=>{console.log("\uD83D\uDE80 Inicializando aplica\xe7\xe3o...");try{var s;h(!0),p(null);let a=await o.y1.getSession();if(!(null==a?void 0:a.user)){console.log("❌ Nenhuma sess\xe3o ativa"),t&&e.push("/login");return}let i=a.user;console.log("✅ Usu\xe1rio autenticado:",i.email),console.log("\uD83D\uDD27 MODO EMERG\xcaNCIA - Criando perfil local sem consultar banco");let l="entregasobral@gmail.com"===i.email,r={id:i.id,email:i.email||"usuario@sistema.com",nome:l?"Administrador":(null==(s=i.email)?void 0:s.split("@")[0])||"Usu\xe1rio",status:"approved",role:l?"admin":"user",created_at:new Date().toISOString()};if(console.log("✅ Perfil local criado:",r),t){j(i),y(r);try{let[e,t]=await Promise.all([o.mB.getAll().catch(()=>[]),o.tn.getAll().catch(()=>[])]);c(e),m(t),console.log("✅ Dados carregados com sucesso")}catch(e){console.warn("⚠️ Erro ao carregar dados, usando dados vazios:",e),c([]),m([])}}}catch(s){console.error("\uD83D\uDCA5 Erro cr\xedtico na inicializa\xe7\xe3o:",s),t&&(p("Erro ao inicializar aplica\xe7\xe3o. Tente fazer login novamente."),setTimeout(()=>{e.push("/login")},2e3))}finally{t&&h(!1)}})(),()=>{t=!1}},[e]);let N=async()=>{try{console.log("\uD83D\uDEAA Fazendo logout..."),sessionStorage.removeItem("appInitialized"),await o.y1.signOut(),setTimeout(()=>{window.location.href="/login"},1e3)}catch(e){console.error("Erro ao fazer logout:",e),setTimeout(()=>{window.location.href="/login"},1e3)}},q=l.reduce((e,t)=>e+t.quantidade,0),C=u.reduce((e,t)=>e+t.quantidade,0),_=l.filter(e=>e.nome.toLowerCase().includes(f.toLowerCase())||e.codigo.toLowerCase().includes(f.toLowerCase())),I=u.filter(e=>e.nome.toLowerCase().includes(f.toLowerCase())||e.codigo.toLowerCase().includes(f.toLowerCase())||e.responsavel.toLowerCase().includes(f.toLowerCase())||e.local.toLowerCase().includes(f.toLowerCase()));return x&&!w?(0,a.jsx)(d,{message:"Verificando autentica\xe7\xe3o..."}):g&&!w?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center max-w-md",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("i",{className:"ri-error-warning-line text-red-500 text-2xl"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Erro de Autentica\xe7\xe3o"}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:g}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("button",{onClick:()=>e.push("/login"),className:"w-full bg-blue-500 text-white px-6 py-2 rounded-xl hover:bg-blue-600 transition-colors",children:"Ir para Login"}),(0,a.jsx)("button",{onClick:()=>e.push("/debug-page"),className:"w-full bg-gray-500 text-white px-6 py-2 rounded-xl hover:bg-gray-600 transition-colors",children:"Ver Detalhes T\xe9cnicos"})]})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center ".concat((null==v?void 0:v.role)==="admin"?"bg-purple-100":"bg-blue-100"),children:(0,a.jsx)("i",{className:"text-xl ".concat((null==v?void 0:v.role)==="admin"?"ri-admin-line text-purple-500":"ri-user-line text-blue-500")})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-800 flex items-center gap-2",children:[null==v?void 0:v.nome,(null==v?void 0:v.role)==="admin"&&(0,a.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-600 text-xs rounded-full",children:"Admin"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null==v?void 0:v.email})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(null==v?void 0:v.role)==="admin"&&(0,a.jsx)(r(),{href:"/admin",children:(0,a.jsx)("button",{className:"p-2 bg-purple-100 text-purple-600 rounded-xl hover:bg-purple-200 transition-colors",title:"Painel Admin",children:(0,a.jsx)("i",{className:"ri-admin-line text-lg"})})}),(0,a.jsx)("button",{onClick:N,className:"p-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-colors",title:"Sair",children:(0,a.jsx)("i",{className:"ri-logout-circle-line text-lg"})})]})]}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-center text-gray-800 mb-6",children:"Sistema de Controle de Estoque"}),(0,a.jsxs)("div",{className:"flex bg-gray-100 rounded-full p-1 mb-4",children:[(0,a.jsxs)("button",{onClick:()=>s("estoque"),className:"flex-1 py-3 px-4 rounded-full text-sm font-medium transition-all ".concat("estoque"===t?"bg-blue-500 text-white shadow-md":"text-gray-600 hover:text-blue-500"),children:["Est. (",q,")"]}),(0,a.jsxs)("button",{onClick:()=>s("utilizados"),className:"flex-1 py-3 px-4 rounded-full text-sm font-medium transition-all ".concat("utilizados"===t?"bg-red-500 text-white shadow-md":"text-gray-600 hover:text-red-500"),children:["Util. (",C,")"]})]}),(0,a.jsxs)("div",{className:"relative mb-4",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)("i",{className:"ri-search-line text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar equipamento...",className:"w-full pl-10 pr-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:f,onChange:e=>b(e.target.value)})]})]}),"estoque"===t&&(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)(r(),{href:"/adicionar",children:(0,a.jsxs)("button",{className:"w-full bg-green-500 text-white py-4 rounded-2xl font-medium shadow-lg hover:bg-green-600 transition-colors !rounded-button flex items-center justify-center gap-2",children:[(0,a.jsx)("i",{className:"ri-add-line text-xl"}),"Adicionar ao Estoque"]})})}),(0,a.jsx)("div",{className:"space-y-4",children:"estoque"===t?_.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-md p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center overflow-hidden",children:e.foto?(0,a.jsx)("img",{src:e.foto,alt:e.nome,className:"w-full h-full object-cover"}):(0,a.jsx)("i",{className:"ri-computer-line text-blue-500 text-xl"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-800",children:e.nome}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.codigo})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-500",children:e.quantidade}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"unidades"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-600 text-xs rounded-full",children:e.categoria}),(0,a.jsx)("span",{className:"px-3 py-1 bg-green-100 text-green-600 text-xs rounded-full font-medium",children:"Dispon\xedvel"})]})]},e.id)):I.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-md p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center",children:(0,a.jsx)("i",{className:"ri-computer-line text-red-500 text-xl"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-800",children:e.nome}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.codigo})]})]}),(0,a.jsx)("span",{className:"px-3 py-1 bg-red-100 text-red-600 text-xs rounded-full font-medium",children:"Utilizado"})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-map-pin-line text-gray-400"}),(0,a.jsxs)("span",{className:"text-gray-600",children:["Local: ",e.local]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-user-line text-gray-400"}),(0,a.jsxs)("span",{className:"text-gray-600",children:["Respons\xe1vel: ",e.responsavel]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("i",{className:"ri-calendar-line text-gray-400"}),(0,a.jsxs)("span",{className:"text-gray-600",children:["Data: ",new Date(e.dataUso||e.data_uso).toLocaleDateString("pt-BR")]})]}),e.observacoes&&(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("i",{className:"ri-file-text-line text-gray-400 mt-0.5"}),(0,a.jsx)("span",{className:"text-gray-600",children:e.observacoes})]})]}),(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100 flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Qtd: ",e.quantidade," unidade",e.quantidade>1?"s":""]}),(0,a.jsx)("button",{className:"text-blue-500 text-sm font-medium hover:text-blue-600 !rounded-button",children:"Devolver"})]})]},e.id))}),("estoque"===t&&0===_.length||"utilizados"===t&&0===I.length)&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("i",{className:"ri-box-3-line text-gray-400 text-2xl"})}),(0,a.jsx)("p",{className:"text-gray-500",children:f?"Nenhum item encontrado":"estoque"===t?"Nenhum equipamento em estoque":"Nenhum equipamento utilizado"})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[754,441,684,358],()=>t(2967)),_N_E=e.O()}]);
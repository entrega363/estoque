(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[331],{3168:(e,t,r)=>{"use strict";r.d(t,{Dv:()=>o,tn:()=>s,us:()=>n,y1:()=>i});let a=(0,r(5647).UU)("https://thtknmmhtfjikzxznjxi.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRodGtubW1odGZqaWt6eHpuanhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI1OTU0MjYsImV4cCI6MjA2ODE3MTQyNn0.Aex9osM2zlneafmSUtmeOt-4pEFOB4JOIeqQdvdKSkA"),s={async getAll(){let{data:e,error:t}=await a.from("equipamentos_utilizados").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:r}=await a.from("equipamentos_utilizados").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async return(e){let{error:t}=await a.from("equipamentos_utilizados").delete().eq("id",e);if(t)throw t}},i={async signIn(e,t){let{data:r,error:s}=await a.auth.signInWithPassword({email:e,password:t});if(s)throw s;return r},async signUp(e,t,r){let{data:s,error:i}=await a.auth.signUp({email:e,password:t,options:{data:{nome:r}}});if(i)throw i;return s.user&&await o.createProfile({id:s.user.id,email:e,nome:r,status:"pending",role:"user",created_at:new Date().toISOString()}),s},async signOut(){let{error:e}=await a.auth.signOut();if(e)throw e},async getCurrentUser(){let{data:{user:e}}=await a.auth.getUser();return e},async getSession(){let{data:{session:e}}=await a.auth.getSession();return e}},o={async createProfile(e){let{data:t,error:r}=await a.from("user_profiles").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async getProfile(e){let{data:t,error:r}=await a.from("user_profiles").select("*").eq("id",e).single();if(r)throw r;return t},async getAllUsers(){let{data:e,error:t}=await a.from("user_profiles").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async approveUser(e,t){let{data:r,error:s}=await a.from("user_profiles").update({status:"approved",approved_at:new Date().toISOString(),approved_by:t}).eq("id",e).select();if(s)throw s;return null==r?void 0:r[0]},async deactivateUser(e){let{data:t,error:r}=await a.from("user_profiles").update({status:"inactive"}).eq("id",e).select();if(r)throw r;return null==t?void 0:t[0]},async activateUser(e){let{data:t,error:r}=await a.from("user_profiles").update({status:"approved"}).eq("id",e).select();if(r)throw r;return null==t?void 0:t[0]},async isAdmin(e){let t=await this.getProfile(e);return(null==t?void 0:t.role)==="admin"&&(null==t?void 0:t.status)==="approved"}},n={async getByUser(e){let{data:t,error:r}=await a.from("equipamentos").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]},async getAllForAdmin(){let{data:e,error:t}=await a.from("equipamentos").select("\n        *,\n        user_profiles!equipamentos_user_id_fkey(nome, email)\n      ").order("created_at",{ascending:!1});if(t)throw t;return e||[]},async create(e){let{data:t,error:r}=await a.from("equipamentos").insert([e]).select();if(r)throw r;return null==t?void 0:t[0]},async checkCodeExistsForUser(e,t){let{data:r,error:s}=await a.from("equipamentos").select("id").eq("codigo",e).eq("user_id",t).limit(1);if(s)throw s;return((null==r?void 0:r.length)||0)>0}}},6876:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),s=r(2115),i=r(6874),o=r.n(i),n=r(5695),l=r(3168);function d(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)({codigo:"",nome:"",quantidade:1,categoria:"Informatica"}),[i,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!1),[m,x]=(0,s.useState)(null),[g,h]=(0,s.useState)(null),[p,f]=(0,s.useState)(!0);(0,s.useEffect)(()=>{b()},[]);let b=async()=>{try{let t=await l.y1.getCurrentUser();if(!t)return void e.push("/login");let r=await l.Dv.getProfile(t.id);if(!r||"approved"!==r.status)return void e.push("/login");h(t)}catch(t){console.error("Erro ao verificar autentica\xe7\xe3o:",t),e.push("/login")}finally{f(!1)}},v=async r=>{if(r.preventDefault(),d(!0),!g){alert("Usu\xe1rio n\xe3o autenticado"),d(!1);return}try{if(await l.us.checkCodeExistsForUser(t.codigo,g.id)){alert("J\xe1 existe um equipamento com este c\xf3digo!"),d(!1);return}await l.us.create({codigo:t.codigo,nome:t.nome,quantidade:t.quantidade,categoria:t.categoria,foto:t.foto,user_id:g.id}),u(!0),setTimeout(()=>{e.push("/")},2e3)}catch(r){console.error("Erro ao salvar equipamento:",r);try{let r={id:Date.now().toString(),codigo:t.codigo,nome:t.nome,quantidade:t.quantidade,categoria:t.categoria,foto:t.foto,user_id:g.id},a=JSON.parse(localStorage.getItem("estoque-equipamentos")||"[]");if(a.some(e=>e.codigo===t.codigo&&e.user_id===g.id)){alert("J\xe1 existe um equipamento com este c\xf3digo!"),d(!1);return}let s=[...a,r];localStorage.setItem("estoque-equipamentos",JSON.stringify(s)),u(!0),setTimeout(()=>{e.push("/")},2e3)}catch(e){console.error("Erro ao salvar no localStorage:",e),alert("Erro ao salvar equipamento. Tente novamente."),d(!1)}}},j=e=>{let{name:t,value:a}=e.target;r(e=>({...e,[t]:"quantidade"===t?parseInt(a)||1:a}))},y=e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(!a.type.startsWith("image/"))return void alert("Por favor, selecione apenas arquivos de imagem.");if(a.size>5242880)return void alert("A imagem deve ter no m\xe1ximo 5MB.");let e=new FileReader;e.onload=e=>{var t;let a=null==(t=e.target)?void 0:t.result;x(a),r(e=>({...e,foto:a}))},e.readAsDataURL(a)}};return p?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-green-200 border-t-green-500 rounded-full animate-spin mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Verificando autentica\xe7\xe3o..."})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4",children:(0,a.jsxs)("div",{className:"max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,a.jsx)(o(),{href:"/",className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center hover:bg-gray-200 transition-colors !rounded-button",children:(0,a.jsx)("i",{className:"ri-arrow-left-line text-gray-600 text-xl"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Adicionar Equipamento"})]}),c&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-green-100 border border-green-200 rounded-xl",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("i",{className:"ri-check-circle-fill text-green-500 text-xl"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-green-800",children:"Sucesso!"}),(0,a.jsx)("p",{className:"text-sm text-green-600",children:"Equipamento adicionado ao estoque"})]})]})}),(0,a.jsxs)("form",{onSubmit:v,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"C\xf3digo do Item"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",name:"codigo",value:t.codigo,onChange:j,placeholder:"Ex: ATT-X200304",className:"flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=Date.now().toString().slice(-6);r(t=>({...t,codigo:"".concat("ATT-X").concat(e)}))},className:"px-4 py-3 bg-gray-100 text-gray-600 rounded-xl hover:bg-gray-200 transition-colors !rounded-button",title:"Gerar c\xf3digo autom\xe1tico",children:(0,a.jsx)("i",{className:"ri-refresh-line"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome do Equipamento"}),(0,a.jsx)("input",{type:"text",name:"nome",value:t.nome,onChange:j,placeholder:"Ex: Notebook Dell Inspiron",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>r(e=>({...e,quantidade:Math.max(1,e.quantidade-1)})),className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center hover:bg-gray-200 transition-colors !rounded-button",children:(0,a.jsx)("i",{className:"ri-subtract-line text-gray-600"})}),(0,a.jsx)("input",{type:"number",name:"quantidade",value:t.quantidade,onChange:j,min:"1",className:"flex-1 text-center px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0}),(0,a.jsx)("button",{type:"button",onClick:()=>r(e=>({...e,quantidade:e.quantidade+1})),className:"w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center hover:bg-gray-200 transition-colors !rounded-button",children:(0,a.jsx)("i",{className:"ri-add-line text-gray-600"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("select",{name:"categoria",value:t.categoria,onChange:j,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent appearance-none bg-white",required:!0,children:["Informatica","Perifericos","Impressao","Mobiliario","Eletronicos","Outros"].map(e=>(0,a.jsx)("option",{value:e,children:e},e))}),(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,a.jsx)("i",{className:"ri-arrow-down-s-line text-gray-400"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Foto do Equipamento (Opcional)"}),m?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"w-full h-32 bg-gray-100 rounded-xl overflow-hidden",children:(0,a.jsx)("img",{src:m,alt:"Preview do equipamento",className:"w-full h-full object-cover"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{x(null),r(e=>({...e,foto:void 0}))},className:"absolute top-2 right-2 w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors !rounded-button",title:"Remover foto",children:(0,a.jsx)("i",{className:"ri-close-line text-sm"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{var e;return null==(e=document.getElementById("photo-upload-replace"))?void 0:e.click()},className:"absolute bottom-2 right-2 px-3 py-1 bg-white bg-opacity-90 text-gray-700 text-xs rounded-full hover:bg-opacity-100 transition-colors !rounded-button",children:"Alterar"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:y,className:"hidden",id:"photo-upload-replace"})]}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:y,className:"hidden",id:"photo-upload"}),(0,a.jsxs)("label",{htmlFor:"photo-upload",className:"w-full h-32 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-green-400 hover:bg-green-50 transition-colors",children:[(0,a.jsx)("i",{className:"ri-camera-line text-3xl text-gray-400 mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"Clique para adicionar foto"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG at\xe9 5MB"})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Pr\xe9-visualiza\xe7\xe3o:"}),(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-4",children:[m&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)("div",{className:"w-full h-24 bg-gray-100 rounded-lg overflow-hidden",children:(0,a.jsx)("img",{src:m,alt:"Preview do equipamento",className:"w-full h-full object-cover"})})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:m?(0,a.jsx)("img",{src:m,alt:"\xcdcone do equipamento",className:"w-full h-full object-cover rounded-xl"}):(0,a.jsx)("i",{className:"ri-computer-line text-green-500"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-gray-800",children:t.nome||"Nome do equipamento"}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:t.codigo||"C\xf3digo do item"})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-xl font-bold text-green-500",children:t.quantidade}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"unidades"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-600 text-xs rounded-full",children:t.categoria}),(0,a.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-600 text-xs rounded-full font-medium",children:"Dispon\xedvel"})]})]})]}),(0,a.jsx)("button",{type:"submit",disabled:i||c,className:"w-full bg-green-500 text-white py-4 rounded-2xl font-medium shadow-lg hover:bg-green-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed !rounded-button flex items-center justify-center gap-2",children:i?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Adicionando..."]}):c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"ri-check-line text-xl"}),"Adicionado com Sucesso!"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"ri-add-line text-xl"}),"Adicionar ao Estoque"]})})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-800 mb-4",children:"A\xe7\xf5es R\xe1pidas"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("button",{className:"p-3 bg-blue-50 text-blue-600 rounded-xl text-sm font-medium hover:bg-blue-100 transition-colors !rounded-button",children:[(0,a.jsx)("i",{className:"ri-scan-line text-lg mb-1 block"}),"Escanear QR"]}),(0,a.jsxs)("button",{className:"p-3 bg-purple-50 text-purple-600 rounded-xl text-sm font-medium hover:bg-purple-100 transition-colors !rounded-button",children:[(0,a.jsx)("i",{className:"ri-file-excel-line text-lg mb-1 block"}),"Importar Excel"]})]})]})]})})}},9431:(e,t,r)=>{Promise.resolve().then(r.bind(r,6876))}},e=>{var t=t=>e(e.s=t);e.O(0,[754,441,684,358],()=>t(9431)),_N_E=e.O()}]);
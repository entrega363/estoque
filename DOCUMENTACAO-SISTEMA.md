# üìã Documenta√ß√£o Completa - Sistema de Controle de Estoque

## üåê Informa√ß√µes Gerais

**Nome:** Sistema de Controle de Estoque  
**Vers√£o:** 1.0.0  
**URL de Produ√ß√£o:** https://estoque-sistema-kapinfsjh-entregasobrals-projects.vercel.app  
**Tecnologias:** Next.js 15, React 19, TypeScript, Supabase, Tailwind CSS  
**Deploy:** Vercel  

---

## üìë √çndice

1. [Vis√£o Geral](#vis√£o-geral)
2. [Arquitetura do Sistema](#arquitetura-do-sistema)
3. [Funcionalidades](#funcionalidades)
4. [Estrutura do Banco de Dados](#estrutura-do-banco-de-dados)
5. [Autentica√ß√£o e Autoriza√ß√£o](#autentica√ß√£o-e-autoriza√ß√£o)
6. [Interface do Usu√°rio](#interface-do-usu√°rio)
7. [API e Servi√ßos](#api-e-servi√ßos)
8. [Configura√ß√£o e Deploy](#configura√ß√£o-e-deploy)
9. [Guia do Usu√°rio](#guia-do-usu√°rio)
10. [Guia do Administrador](#guia-do-administrador)
11. [Troubleshooting](#troubleshooting)
12. [Manuten√ß√£o](#manuten√ß√£o)

---

## üéØ Vis√£o Geral

O Sistema de Controle de Estoque √© uma aplica√ß√£o web moderna desenvolvida para gerenciar invent√°rios de equipamentos e produtos. O sistema oferece controle de acesso baseado em roles, aprova√ß√£o de usu√°rios e interface intuitiva para opera√ß√µes de estoque.

### Principais Caracter√≠sticas:
- ‚úÖ Sistema de autentica√ß√£o seguro
- ‚úÖ Controle de acesso baseado em roles (Admin/Usu√°rio)
- ‚úÖ Aprova√ß√£o manual de novos usu√°rios
- ‚úÖ Gerenciamento completo de estoque
- ‚úÖ Interface responsiva e moderna
- ‚úÖ Deploy autom√°tico na nuvem

---

## üèóÔ∏è Arquitetura do Sistema

### Stack Tecnol√≥gico:

**Frontend:**
- Next.js 15 (React Framework)
- React 19 (UI Library)
- TypeScript (Type Safety)
- Tailwind CSS (Styling)
- Remix Icons (Iconografia)

**Backend:**
- Supabase (Backend as a Service)
- PostgreSQL (Database)
- Row Level Security (RLS)
- Real-time subscriptions

**Deploy:**
- Vercel (Hosting)
- GitHub (Version Control)
- Automatic deployments

### Estrutura de Pastas:
```
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/            # Rotas de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ sistema/           # Dashboard principal
‚îÇ   ‚îú‚îÄ‚îÄ gerenciar-usuarios/ # Painel admin
‚îÇ   ‚îú‚îÄ‚îÄ adicionar/         # Adicionar produtos
‚îÇ   ‚îî‚îÄ‚îÄ api/               # API routes
‚îú‚îÄ‚îÄ components/            # Componentes reutiliz√°veis
‚îú‚îÄ‚îÄ lib/                   # Utilit√°rios e configura√ß√µes
‚îú‚îÄ‚îÄ database/              # Scripts SQL
‚îî‚îÄ‚îÄ public/                # Assets est√°ticos
```

---

## ‚öôÔ∏è Funcionalidades

### üîê Autentica√ß√£o
- **Cadastro de usu√°rios** com valida√ß√£o de email
- **Login seguro** com sess√£o persistente
- **Logout** com limpeza de sess√£o
- **Recupera√ß√£o de senha** (via Supabase)

### üë• Gerenciamento de Usu√°rios
- **Aprova√ß√£o manual** de novos usu√°rios
- **Sistema de roles** (Admin/Usu√°rio)
- **Status de usu√°rio** (Pending/Approved/Inactive)
- **Painel administrativo** para gerenciar usu√°rios

### üì¶ Controle de Estoque
- **Adicionar produtos** com c√≥digo, nome, quantidade, categoria
- **Upload de fotos** dos produtos
- **Listagem de produtos** com filtros
- **Controle por usu√°rio** (cada usu√°rio v√™ seus produtos)
- **Relat√≥rios** de estoque

### üé® Interface
- **Design responsivo** para desktop e mobile
- **Tema moderno** com gradientes e sombras
- **Feedback visual** para a√ß√µes do usu√°rio
- **Loading states** e anima√ß√µes suaves

---

## üóÑÔ∏è Estrutura do Banco de Dados

### Tabelas Principais:

#### `user_profiles`
```sql
- id (UUID, PK) - Refer√™ncia ao auth.users
- email (VARCHAR) - Email do usu√°rio
- nome (VARCHAR) - Nome completo
- status (ENUM) - pending, approved, inactive
- role (ENUM) - admin, user
- created_at (TIMESTAMP) - Data de cria√ß√£o
- approved_at (TIMESTAMP) - Data de aprova√ß√£o
- approved_by (UUID) - Quem aprovou
```

#### `equipamentos`
```sql
- id (UUID, PK) - Identificador √∫nico
- codigo (VARCHAR) - C√≥digo do produto
- nome (VARCHAR) - Nome do produto
- quantidade (INTEGER) - Quantidade em estoque
- categoria (VARCHAR) - Categoria do produto
- foto (TEXT) - Base64 da imagem
- user_id (UUID, FK) - Propriet√°rio do produto
- created_at (TIMESTAMP) - Data de cria√ß√£o
- updated_at (TIMESTAMP) - √öltima atualiza√ß√£o
```

#### `equipamentos_utilizados`
```sql
- id (UUID, PK) - Identificador √∫nico
- codigo (VARCHAR) - C√≥digo do equipamento
- nome (VARCHAR) - Nome do equipamento
- quantidade (INTEGER) - Quantidade utilizada
- local (VARCHAR) - Local de uso
- responsavel (VARCHAR) - Respons√°vel pelo uso
- data_uso (DATE) - Data de utiliza√ß√£o
- observacoes (TEXT) - Observa√ß√µes
- created_at (TIMESTAMP) - Data de registro
```

### Pol√≠ticas RLS (Row Level Security):

**user_profiles:**
- Usu√°rios podem ver/editar apenas seu pr√≥prio perfil
- Admins podem ver/editar todos os perfis

**equipamentos:**
- Usu√°rios podem ver/editar apenas seus pr√≥prios equipamentos
- Admins podem ver todos os equipamentos

**equipamentos_utilizados:**
- Todos os usu√°rios autenticados podem acessar

---

## üîí Autentica√ß√£o e Autoriza√ß√£o

### Fluxo de Autentica√ß√£o:

1. **Cadastro:**
   - Usu√°rio preenche formul√°rio (nome, email, senha)
   - Supabase cria conta na tabela `auth.users`
   - Trigger autom√°tico cria perfil em `user_profiles`
   - Status inicial: `pending`

2. **Aprova√ß√£o:**
   - Admin acessa painel de gerenciamento
   - Aprova ou rejeita usu√°rios pendentes
   - Status muda para `approved` ou `inactive`

3. **Login:**
   - Verifica√ß√£o de credenciais via Supabase Auth
   - Verifica√ß√£o de status `approved`
   - Redirecionamento baseado no role

### Roles e Permiss√µes:

**Admin:**
- Acesso total ao sistema
- Pode aprovar/rejeitar usu√°rios
- Pode alterar roles de outros usu√°rios
- V√™ todos os equipamentos (opcional)

**User:**
- Acesso ao sistema ap√≥s aprova√ß√£o
- Pode gerenciar apenas seus equipamentos
- N√£o pode acessar painel administrativo

---

## üé® Interface do Usu√°rio

### P√°ginas Principais:

#### üè† P√°gina Inicial (`/`)
- Landing page com informa√ß√µes do sistema
- Links para login e cadastro
- Design atrativo com call-to-action

#### üîê Login (`/login`)
- Formul√°rio de autentica√ß√£o
- Valida√ß√£o em tempo real
- Feedback de erros
- Bot√£o vermelho personalizado
- Informa√ß√µes de acesso admin

#### üìù Cadastro (`/cadastro`)
- Formul√°rio de registro
- Valida√ß√£o de campos
- Confirma√ß√£o de senha
- Termos de uso

#### ‚è≥ Aguardando Aprova√ß√£o (`/aguardando-aprovacao`)
- P√°gina de espera para usu√°rios pendentes
- Informa√ß√µes sobre o processo de aprova√ß√£o
- Op√ß√£o de logout

#### üè¢ Sistema (`/sistema`)
- Dashboard principal
- Cards de navega√ß√£o
- Status do sistema
- Informa√ß√µes do usu√°rio logado
- Debug info (tempor√°rio)

#### üë• Gerenciar Usu√°rios (`/gerenciar-usuarios`)
- Lista de todos os usu√°rios
- Estat√≠sticas de usu√°rios
- A√ß√µes de aprova√ß√£o/rejei√ß√£o
- Altera√ß√£o de roles
- Filtros e busca

#### ‚ûï Adicionar Produto (`/adicionar`)
- Formul√°rio de cadastro de produtos
- Upload de imagem
- Valida√ß√£o de c√≥digo √∫nico
- Categoriza√ß√£o

### Componentes Visuais:

**Design System:**
- **Cores:** Gradientes azul/√≠ndigo, verde, vermelho, laranja
- **Tipografia:** Inter font, hierarquia clara
- **Espa√ßamento:** Sistema baseado em 4px
- **Sombras:** M√∫ltiplas camadas para profundidade
- **Bordas:** Arredondadas (8px, 12px, 16px)

**Componentes:**
- Cards com hover effects
- Bot√µes com estados (normal, hover, disabled)
- Formul√°rios com valida√ß√£o visual
- Loading spinners
- Toasts de feedback
- Modais responsivos

---

## üîß API e Servi√ßos

### Servi√ßos Principais:

#### `authService`
```typescript
- signIn(email, password) - Fazer login
- signUp(email, password, nome) - Cadastrar usu√°rio
- signOut() - Fazer logout
- getCurrentUser() - Obter usu√°rio atual
- getSession() - Obter sess√£o ativa
```

#### `userService`
```typescript
- getUserProfile(userId) - Buscar perfil
- getAllUsers() - Listar todos usu√°rios (admin)
- updateUserStatus(userId, status) - Alterar status
- updateUserRole(userId, role) - Alterar role
- approveUser(userId, adminId) - Aprovar usu√°rio
```

#### `equipmentService`
```typescript
- getAll() - Listar equipamentos
- create(equipment) - Criar equipamento
- update(id, updates) - Atualizar equipamento
- delete(id) - Deletar equipamento
- checkCodeExists(codigo) - Verificar c√≥digo √∫nico
```

### Configura√ß√£o Supabase:

**Vari√°veis de Ambiente:**
```env
NEXT_PUBLIC_SUPABASE_URL=https://rtajuzunzkoamruejtim.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Configura√ß√µes RLS:**
- Habilitado em todas as tabelas
- Pol√≠ticas espec√≠ficas por role
- Seguran√ßa a n√≠vel de linha

---

## üöÄ Configura√ß√£o e Deploy

### Desenvolvimento Local:

1. **Clonar reposit√≥rio:**
```bash
git clone https://github.com/entrega363/estoque.git
cd estoque
```

2. **Instalar depend√™ncias:**
```bash
npm install
```

3. **Configurar vari√°veis:**
```bash
cp .env.example .env.local
# Editar .env.local com suas credenciais
```

4. **Executar desenvolvimento:**
```bash
npm run dev
```

### Deploy Vercel:

**Autom√°tico via GitHub:**
- Push para branch `main` dispara deploy
- Build autom√°tico com Next.js
- Vari√°veis de ambiente configuradas no painel

**Manual via CLI:**
```bash
vercel login
vercel --prod
```

### Configura√ß√µes de Build:

**next.config.js:**
```javascript
- ESLint desabilitado no build
- Headers CORS configurados
- Otimiza√ß√µes para Supabase
```

**vercel.json:**
```json
- Framework: Next.js
- Build command: npm run build
- Output directory: .next
- Vari√°veis de ambiente
```

---

## üë§ Guia do Usu√°rio

### Como Come√ßar:

1. **Acessar o sistema:**
   - V√° para: https://estoque-sistema-kapinfsjh-entregasobrals-projects.vercel.app

2. **Criar conta:**
   - Clique em "Cadastre-se"
   - Preencha: nome, email, senha
   - Confirme o cadastro

3. **Aguardar aprova√ß√£o:**
   - Sua conta ficar√° pendente
   - Aguarde aprova√ß√£o do administrador
   - Voc√™ receber√° acesso ap√≥s aprova√ß√£o

4. **Fazer login:**
   - Use email e senha cadastrados
   - Acesse o dashboard principal

### Usando o Sistema:

**Dashboard Principal:**
- Vis√£o geral do sistema
- Acesso r√°pido √†s funcionalidades
- Status do seu estoque

**Adicionar Produtos:**
- Clique em "Adicionar Produto"
- Preencha: c√≥digo, nome, quantidade, categoria
- Adicione foto (opcional)
- Salve o produto

**Gerenciar Estoque:**
- Visualize seus produtos
- Edite informa√ß√µes
- Controle quantidades
- Organize por categorias

---

## üë®‚Äçüíº Guia do Administrador

### Credenciais de Admin:
- **Email:** entregasobral@gmail.com
- **Senha:** tenderbr0

### Funcionalidades Administrativas:

**Gerenciar Usu√°rios:**
1. Acesse "Gerenciar Usu√°rios" no dashboard
2. Visualize lista de usu√°rios pendentes
3. Aprove ou rejeite cadastros
4. Altere roles (admin/usu√°rio)
5. Desative usu√°rios se necess√°rio

**Estat√≠sticas:**
- Total de usu√°rios
- Usu√°rios aprovados/pendentes
- Administradores ativos
- Produtos no sistema

**A√ß√µes Dispon√≠veis:**
- ‚úÖ Aprovar usu√°rio
- ‚ùå Rejeitar usu√°rio
- üëë Tornar administrador
- üë§ Remover privil√©gios admin
- üîí Desativar conta

### P√°ginas de Debug:

**Debug Usu√°rios (`/debug-usuarios`):**
- Informa√ß√µes t√©cnicas
- Estado da sess√£o
- Testes de funcionalidade
- Logs detalhados

**Test Admin (`/test-admin`):**
- Verifica√ß√£o de permiss√µes
- Teste de acesso
- Diagn√≥stico de problemas

---

## üîß Troubleshooting

### Problemas Comuns:

**1. Usu√°rio n√£o consegue fazer login:**
- Verificar se est√° aprovado (status = approved)
- Confirmar credenciais corretas
- Limpar cache do navegador

**2. Card "Gerenciar Usu√°rios" n√£o aparece:**
- Verificar se role = admin
- Fazer logout e login novamente
- Verificar no /test-admin

**3. Erro de build no Vercel:**
- Verificar tipos TypeScript
- Confirmar vari√°veis de ambiente
- Revisar logs de build

**4. Problemas de permiss√£o no banco:**
- Verificar pol√≠ticas RLS
- Confirmar usu√°rio na tabela user_profiles
- Executar scripts de corre√ß√£o

### Scripts de Corre√ß√£o:

**Aprovar admin:**
```sql
UPDATE user_profiles 
SET status = 'approved', role = 'admin' 
WHERE email = 'entregasobral@gmail.com';
```

**Verificar usu√°rios:**
```sql
SELECT id, nome, email, role, status 
FROM user_profiles 
ORDER BY created_at;
```

**Recriar pol√≠ticas RLS:**
```bash
# Execute: database/fix-rls-admin.sql
```

---

## üõ†Ô∏è Manuten√ß√£o

### Tarefas Regulares:

**Di√°rias:**
- Monitorar logs de erro
- Verificar novos cadastros
- Aprovar usu√°rios pendentes

**Semanais:**
- Backup do banco de dados
- An√°lise de performance
- Atualiza√ß√£o de depend√™ncias

**Mensais:**
- Limpeza de dados antigos
- Revis√£o de seguran√ßa
- Otimiza√ß√£o de queries

### Monitoramento:

**M√©tricas Importantes:**
- Tempo de resposta das p√°ginas
- Taxa de erro de login
- N√∫mero de usu√°rios ativos
- Uso de storage

**Logs √öteis:**
- Vercel Function Logs
- Supabase Dashboard
- Browser Console
- Network requests

### Backup e Recupera√ß√£o:

**Backup Autom√°tico:**
- Supabase faz backup autom√°tico
- Reten√ß√£o de 7 dias (plano gratuito)
- Backup manual via dashboard

**Recupera√ß√£o:**
- Restore via Supabase dashboard
- Scripts SQL de emerg√™ncia
- Redeployment via Vercel

---

## üìû Suporte

### Contatos:
- **Desenvolvedor:** Kiro AI Assistant
- **Email de Suporte:** entregasobral@gmail.com
- **Reposit√≥rio:** https://github.com/entrega363/estoque

### Recursos √öteis:
- **Next.js Docs:** https://nextjs.org/docs
- **Supabase Docs:** https://supabase.com/docs
- **Vercel Docs:** https://vercel.com/docs
- **Tailwind CSS:** https://tailwindcss.com/docs

---

## üìù Changelog

### v1.0.0 (02/08/2025)
- ‚úÖ Sistema de autentica√ß√£o completo
- ‚úÖ Gerenciamento de usu√°rios
- ‚úÖ Controle de estoque b√°sico
- ‚úÖ Interface responsiva
- ‚úÖ Deploy no Vercel
- ‚úÖ Documenta√ß√£o completa

### Pr√≥ximas Vers√µes:
- üìã Relat√≥rios avan√ßados
- üìä Dashboard com gr√°ficos
- üîî Sistema de notifica√ß√µes
- üì± App mobile
- üîç Busca avan√ßada
- üì§ Exporta√ß√£o de dados

---

**¬© 2025 Sistema de Controle de Estoque - Desenvolvido com ‚ù§Ô∏è usando Next.js e Supabase**